<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - AI Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* NEW DARK MODE THEME */
        body { background-color: #0a0a0a; color: #87CEEB; scroll-behavior: smooth; font-family: 'Inter', sans-serif; }
        
        .sidebar { background-color: #000000; width: 260px; height: 100vh; position: fixed; top: 0; left: 0; z-index: 100; border-right: 1px solid #222; }
        .sidebar a { color: #FFFFFF; text-decoration: none; padding: 12px 20px; border-radius: 8px; margin-bottom: 5px; display: block; transition: 0.3s; }
        .sidebar a:hover, .sidebar a.active { background-color: #87CEEB; color: #000000; font-weight: bold; }
        
        .main-content { margin-left: 260px; padding: 40px; }
        
        .figma-card { background: #121212; border-radius: 12px; border: 1px solid #222; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.5); transition: transform 0.3s, box-shadow 0.3s; }
        .figma-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.8); border-color: #87CEEB; }
        
        /* Global Text Colors */
        h1, h2, h3, h4, h5, h6, strong, span, p { color: #87CEEB; }
        small { color: #FFFFFF; font-weight: 500; }
        
        /* Animations */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .anim-up { animation: fadeUp 0.6s ease-out forwards; opacity: 0; }
        .d-1 { animation-delay: 0.1s; } .d-2 { animation-delay: 0.2s; } .d-3 { animation-delay: 0.3s; }
        
        /* THE FIX FOR THE GROWING CHART */
        .chart-wrapper { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body>
    <div class="sidebar p-4 d-flex flex-column">
        <h4 style="color:#87CEEB" class="mb-0">AI Tracker</h4><small class="mb-4">Retail Analytics</small>
        <a href="/dashboard" class="active">Dashboard</a>
        <a href="/zones">Zone Comparison</a>
        <a href="/statistics">Statistical Analysis</a>
        <a href="/export">Reports Export</a>
        <a href="/gdpr">GDPR Privacy Mode</a>
        <div class="mt-auto p-3 bg-dark rounded border border-success"><small style="color:#98FF98">üõ°Ô∏è GDPR Compliant</small></div>
    </div>

    <div class="main-content">
        <div class="d-flex justify-content-between align-items-end mb-4 anim-up">
            <div><h2>Dashboard</h2><small>Real-time store metrics</small></div>
            <a href="/" class="btn btn-outline-info">Back to Camera</a>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-md-3 anim-up d-1"><div class="figma-card"><small>Total Detections</small><h2 id="kpi-footfall" class="mt-2">...</h2></div></div>
            <div class="col-md-3 anim-up d-1"><div class="figma-card"><small>Mean Dwell Time</small><h2 class="mt-2"><span id="kpi-dwell">...</span><small class="fs-6"> min</small></h2></div></div>
            <div class="col-md-3 anim-up d-2"><div class="figma-card"><small>Engagement Score</small><h2 class="mt-2"><span id="kpi-engage">...</span><small class="fs-6"> /100</small></h2></div></div>
            <div class="col-md-3 anim-up d-2"><div class="figma-card"><small>AI Confidence</small><h2 class="mt-2"><span id="kpi-conf">...</span><small class="fs-6"> %</small></h2></div></div>
        </div>

        <div class="row g-4 anim-up d-3">
            <div class="col-md-6">
                <div class="figma-card h-100">
                    <h5>Activity by Zone</h5>
                    <div class="chart-wrapper">
                        <canvas id="dashChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="figma-card h-100 d-flex align-items-center justify-content-center" style="background:#0a0a0a;">
                    <small>Store Layout Heatmap Projection Area</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Set default Chart.js text colors for Dark Mode
        Chart.defaults.color = '#FFFFFF';
        Chart.defaults.borderColor = '#222222';

        let chart = null;
        async function loadData() {
            const res = await fetch('/api/data');
            const data = await res.json();
            if(data.status === "success") {
                document.getElementById('kpi-footfall').innerText = data.data.total_footfall;
                document.getElementById('kpi-dwell').innerText = data.data.avg_dwell_min;
                document.getElementById('kpi-engage').innerText = data.data.avg_engagement;
                document.getElementById('kpi-conf').innerText = data.data.ai_confidence;
                
                const ctx = document.getElementById('dashChart').getContext('2d');
                if(chart) chart.destroy();
                chart = new Chart(ctx, {
                    type: 'bar',
                    data: { 
                        labels: Object.keys(data.data.zones), 
                        datasets: [{ 
                            label: 'Footfall', 
                            data: Object.values(data.data.zones).map(z => z.footfall), 
                            backgroundColor: '#98FF98', // Mint Green
                            borderRadius: 4 
                        }] 
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, // Prevents the growing bug
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
        }
        loadData(); setInterval(loadData, 5000);
    </script>
</body>
</html>
