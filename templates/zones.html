<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zone Comparison</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* DARK MODE THEME */
        body { background-color: #0a0a0a; color: #87CEEB; scroll-behavior: smooth; font-family: 'Inter', sans-serif;}
        .sidebar { background-color: #000000; width: 260px; height: 100vh; position: fixed; top: 0; left: 0; z-index: 100; border-right: 1px solid #222;}
        .sidebar a { color: #FFFFFF; text-decoration: none; padding: 12px 20px; border-radius: 8px; margin-bottom: 5px; display: block; transition: 0.3s; }
        .sidebar a:hover, .sidebar a.active { background-color: #87CEEB; color: #000000; font-weight: bold; }
        .main-content { margin-left: 260px; padding: 40px; }
        .figma-card { background: #121212; border-radius: 12px; border: 1px solid #222; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.5); transition: transform 0.3s, box-shadow 0.3s; }
        .figma-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.8); border-color: #87CEEB; }
        
        /* Global Text Colors */
        h1, h2, h3, h4, h5, h6, strong, span, p, td, th { color: #87CEEB !important; }
        small { color: #FFFFFF; font-weight: 500; }
        
        /* Animations */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .anim-up { animation: fadeUp 0.6s ease-out forwards; opacity: 0; }
        .d-1 { animation-delay: 0.1s; } .d-2 { animation-delay: 0.2s; } .d-3 { animation-delay: 0.3s; }
        
        /* CHART WRAPPER FIX */
        .chart-wrapper { position: relative; height: 300px; width: 100%; }
        
        /* Dark table overrides */
        .table-hover tbody tr:hover td { background-color: #1a1a1a; }
        table { border-color: #333 !important; }
    </style>
</head>
<body>
    <div class="sidebar p-4 d-flex flex-column">
        <h4 style="color:#87CEEB" class="mb-0">AI Tracker</h4><small class="mb-4">Retail Analytics</small>
        <a href="/dashboard">Dashboard</a>
        <a href="/zones" class="active">Zone Comparison</a>
        <a href="/statistics">Statistical Analysis</a>
        <a href="/export">Reports Export</a>
        <a href="/gdpr">GDPR Privacy Mode</a>
    </div>

    <div class="main-content">
        <div class="mb-4 anim-up">
            <h2>Zone Comparison</h2>
            <small>Comparative analysis across store zones</small>
        </div>

        <div class="row g-4 mb-4 anim-up d-1" id="zone-cards">
            </div>

        <div class="row g-4 mb-4 anim-up d-2">
            <div class="col-md-6">
                <div class="figma-card h-100">
                    <h5 class="mb-4">Footfall & Dwell Time by Zone</h5>
                    <div class="chart-wrapper"><canvas id="barChart"></canvas></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="figma-card h-100">
                    <h5 class="mb-4">Multi-Metric Performance Radar</h5>
                    <div class="chart-wrapper"><canvas id="radarChart"></canvas></div>
                </div>
            </div>
        </div>

        <div class="figma-card anim-up d-3">
            <h5 class="mb-4">Detailed Zone Metrics</h5>
            <div class="table-responsive">
                <table class="table table-hover table-dark align-middle bg-transparent">
                    <thead>
                        <tr>
                            <th>Zone</th>
                            <th>Footfall</th>
                            <th>Dwell Time (min)</th>
                            <th>Conversion %</th>
                            <th>Engagement</th>
                            <th>Performance</th>
                        </tr>
                    </thead>
                    <tbody id="zone-table-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Set default Chart.js text colors for Dark Mode
        Chart.defaults.color = '#FFFFFF';
        Chart.defaults.borderColor = '#222222';

        let barChart = null;
        let radarChart = null;

        async function loadZoneData() {
            const res = await fetch('/api/data');
            const result = await res.json();
            
            if (result.status === "success") {
                const zones = result.data.zones;
                const labels = Object.keys(zones);
                
                // 1. Populate Zone Cards
                let cardsHtml = '';
                let tableHtml = '';
                labels.forEach(zone => {
                    const data = zones[zone];
                    let perfBadge = data.conversion_rate > 70 ? '<span class="badge" style="background-color: #98FF98; color: #000 !important;">Excellent</span>' : '<span class="badge bg-warning text-dark">Moderate</span>';
                    
                    cardsHtml += `
                        <div class="col-md-4">
                            <div class="figma-card border-top border-4" style="border-top-color: #98FF98 !important;">
                                <h5 class="mb-3">${zone}</h5>
                                <div class="d-flex justify-content-between mb-2"><small>Footfall</small><strong>${data.footfall}</strong></div>
                                <div class="d-flex justify-content-between mb-2"><small>Dwell Time</small><strong style="color: #98FF98 !important;">${data.dwell_min} min</strong></div>
                                <div class="d-flex justify-content-between"><small>Conversion</small><strong style="color: #98FF98 !important;">${data.conversion_rate}%</strong></div>
                            </div>
                        </div>`;
                        
                    tableHtml += `
                        <tr>
                            <td class="fw-bold">${zone}</td>
                            <td>${data.footfall}</td>
                            <td>${data.dwell_min} min</td>
                            <td>${data.conversion_rate}%</td>
                            <td>${data.engagement}/100</td>
                            <td>${perfBadge}</td>
                        </tr>`;
                });
                document.getElementById('zone-cards').innerHTML = cardsHtml;
                document.getElementById('zone-table-body').innerHTML = tableHtml;

                // 2. Bar Chart (Mint Green and Sky Blue)
                const barCtx = document.getElementById('barChart').getContext('2d');
                if (barChart) barChart.destroy();
                barChart = new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Footfall', data: labels.map(z => zones[z].footfall), backgroundColor: '#98FF98', borderRadius: 4 },
                            { label: 'Dwell (min) x10', data: labels.map(z => zones[z].dwell_min * 10), backgroundColor: '#87CEEB', borderRadius: 4 }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });

                // 3. Radar Chart (Unchanged Logic, Adjusted for Dark Theme Text visibility)
                const radarCtx = document.getElementById('radarChart').getContext('2d');
                if (radarChart) radarChart.destroy();
                radarChart = new Chart(radarCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Footfall', 'Dwell Time', 'Engagement', 'Conversion'],
                        datasets: labels.map((zone, i) => ({
                            label: zone,
                            data: [zones[zone].footfall / 10, zones[zone].dwell_min, zones[zone].engagement, zones[zone].conversion_rate],
                            backgroundColor: i === 0 ? 'rgba(59, 130, 246, 0.2)' : (i === 1 ? 'rgba(249, 115, 22, 0.2)' : 'rgba(239, 68, 68, 0.2)'),
                            borderColor: i === 0 ? '#3B82F6' : (i === 1 ? '#F97316' : '#EF4444'),
                            borderWidth: 2
                        }))
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        elements: { line: { tension: 0.3 } },
                        scales: { r: { grid: { color: '#333' }, angleLines: { color: '#333' }, pointLabels: { color: '#87CEEB' } } }
                    }
                });
            }
        }
        loadZoneData();
    </script>
</body>
</html>
